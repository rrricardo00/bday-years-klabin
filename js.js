document.querySelector('#downloadBodas').innerText = "Loading..."
document.querySelector('#downloadBodas').innerText = "Download da imagem"

function downloadImage() {
  const payload = {
    method: "GET",
    headers: DEFAULT_HEADERS,
  };
  
  fetch(`/o/birthday-years-of-work/image-generation?p_auth=${Liferay.authToken}`, payload)
    .then((response) => response.json())
    .then((data) => createAndDownloadFile(data))
    .catch((err) => console.error("Error downloading image", err));
}


async function sendMail(e) {
  e.preventDefault();
  const emailValue = document.querySelector('.kdw__weddin_email').value

  const payload = {
    method: "POST",
    headers: DEFAULT_HEADERS,
  }

  try {
    
    if(emailValue !== ''){
      document.querySelector('#sendEmailBodas').innerText = "Loading..."
      const response = await fetch(`/o/birthday-years-of-work/image-by-email/${emailValue}?p_auth=${Liferay.authToken}`, payload)
      const data = await response.text()
      document.querySelector('#sendEmailBodas').innerText = "Enviar para o e-mail"
      return data
    }
    
  } catch (error) {
    console.log(error)
  }
}


var isBirthday = async () => {

  let isBday = false

  const payload = {
    method: "GET",
    headers: {
      'Content-Type': 'application/json',
    }
  }

  try {
    
    const response = await fetch("/o/birthday-years-of-work/isUserBirthdayYear?p_auth=" + Liferay.authToken, payload)
    const data = await response.json()
    isBday = data

    !isBday ? window.location.href = "/group/guest/bodas-klabin" : createContent()

  } catch (error) {
    console.log(error)
    window.location.href = "/group/guest/bodas-klabin"
  }

  return isBday

}

var createContent = () => {

  document.querySelector('.kdw__wedding_section').innerHTML =
    `
    <div class="container">
<lfr-widget-breadcrumb />
<div class="kdw__title_wedding">
  <h3>
    <lfr-editable id="kdw-weddin-title" type="text">
      ANOS NA KLABIN
    </lfr-editable>
  </h3>
</div>
</div>

<div class="kdw__steps d-flex">
<div class="kdw__size">
  <div
    class="kdw__background_step d-flex justify-content-center align-items-center"
  >
    <svg
      width="36"
      height="66"
      viewBox="0 0 36 66"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M7.61085 7.68866C10.8438 4.42268 15.3227 2.41546 20.2732 2.41546V4.49072C15.8952 4.49072 11.9551 6.29381 9.09261 9.18557C6.23012 12.0773 4.44528 16.0577 4.44528 20.4804H6.8363C6.8363 16.7381 8.35173 13.3361 10.7764 10.8866C13.2011 8.43711 16.5688 6.90619 20.2732 6.90619V8.98144C17.1413 8.98144 14.2788 10.2742 12.2245 12.3495C10.1703 14.4247 8.89055 17.2825 8.89055 20.4804H11.2816C11.2816 17.9629 12.2919 15.7175 13.9083 14.0845C15.5248 12.4515 17.7811 11.4309 20.2395 11.4309V13.5062C18.3199 13.5062 16.6024 14.2887 15.3564 15.5474C14.1104 16.8062 13.3358 18.5753 13.3358 20.4804H15.7268C15.7268 19.2216 16.232 18.0649 17.0402 17.2485C17.8485 16.432 18.9935 15.9216 20.2395 15.9216V66H22.6305V0H20.2395C14.6492 0 9.59775 2.27938 5.92703 5.98763C2.25631 9.69588 0 14.799 0 20.4464H2.39102C2.39102 15.4794 4.37792 10.9546 7.61085 7.68866ZM24.7184 0V65.966H27.1094V0H24.7184ZM29.1637 0V65.966H31.5547V0H29.1637ZM33.609 0V65.966H36V0H33.609Z"
        fill="#8DC44F"
      />
    </svg>
  </div>
  <span>
    <lfr-editable id="kdw-weddin-description-1" type="rich-text">
      Clique nos botões <strong>"Enviar para E-mail"</strong> ou
      <strong>"Download da Imagem"</strong> para baixar a imagem. Se o seu
      perfil na Minha Klabin estiver com foto, ela vai aparecer na imagem
      gerada.
    </lfr-editable>
  </span>
</div>

<div class="kdw__size">
  <div
    class="kdw__background_step d-flex justify-content-center align-items-center"
  >
    <svg
      width="41"
      height="66"
      viewBox="0 0 41 66"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M7.70241 7.69263C10.9742 4.42496 15.5071 2.41671 20.517 2.41671C25.4929 2.41671 30.0258 4.42496 33.2976 7.69263C36.5694 10.9603 38.5802 15.4874 38.5802 20.4569C38.5802 25.4265 36.5694 29.9536 33.2976 33.2212C30.0258 36.4889 25.4929 38.4972 20.517 38.4972C18.5744 38.4972 16.8362 39.28 15.5752 40.5395C14.3142 41.7989 13.5303 43.5689 13.5303 45.475H15.9501C15.9501 44.2156 16.4613 43.0583 17.2793 42.2414C18.0973 41.4244 19.256 40.9139 20.517 40.9139C26.1746 40.9139 31.2868 38.6333 35.0017 34.9232C38.7165 31.213 41 26.1073 41 20.4569C41 14.8066 38.7165 9.70088 35.0017 5.99072C31.2868 2.28056 26.1746 0 20.517 0C14.8254 0 9.71322 2.28056 5.99834 5.99072C2.28346 9.70088 0 14.8066 0 20.4569H2.41978C2.41978 15.4874 4.43059 10.9603 7.70241 7.69263ZM0 66V45.5431C0 39.8927 2.28346 34.787 5.99834 31.0768C9.71322 27.3667 14.8254 25.0861 20.483 25.0861C21.744 25.0861 22.9027 24.5756 23.7207 23.7586C24.5387 22.9417 25.0499 21.7844 25.0499 20.525C25.0499 19.2656 24.5387 18.1083 23.7207 17.2914C22.9027 16.4745 21.744 15.9639 20.483 15.9639C19.2219 15.9639 18.0632 16.4745 17.2452 17.2914C16.4273 18.1083 15.916 19.2656 15.916 20.525H13.4963C13.4963 18.5848 14.2801 16.8489 15.5411 15.5895C16.8022 14.3301 18.5744 13.5472 20.483 13.5472C22.3915 13.5472 24.1638 14.3301 25.4248 15.5895C26.6858 16.8489 27.4697 18.6189 27.4697 20.525C27.4697 22.4652 26.6858 24.2011 25.4248 25.4605C24.1638 26.72 22.3915 27.5028 20.483 27.5028C15.5071 27.5028 10.9742 29.5111 7.70241 32.7788C4.43059 36.0464 2.41978 40.5735 2.41978 45.5431V66H0ZM4.49875 45.509C4.49875 41.0841 6.30507 37.1016 9.20199 34.2084C12.0989 31.3151 16.0865 29.5111 20.517 29.5111C23.0391 29.5111 25.2884 28.4899 26.9244 26.8561C28.5603 25.2223 29.5827 22.9417 29.5827 20.4569C29.5827 17.9381 28.5603 15.6916 26.9244 14.0578C25.2884 12.4239 23.005 11.4028 20.517 11.4028C17.995 11.4028 15.7456 12.4239 14.1097 14.0578C12.4738 15.6916 11.4514 17.9722 11.4514 20.4569H9.03159C9.03159 17.2914 10.3267 14.3981 12.4057 12.3218C14.4846 10.2455 17.3475 8.95204 20.5511 8.95204C23.7548 8.95204 26.6176 10.2455 28.6966 12.3218C30.7756 14.3981 32.0707 17.2573 32.0707 20.4569C32.0707 23.6225 30.7756 26.5157 28.6966 28.5921C26.6176 30.6684 23.7548 31.9618 20.5511 31.9618C16.8022 31.9618 13.394 33.4936 10.9401 35.9443C8.48628 38.3951 6.95262 41.7989 6.95262 45.5431V66H4.53283V45.509H4.49875ZM8.99751 45.509C8.99751 42.3435 10.2926 39.4502 12.3716 37.3739C14.4505 35.2976 17.3134 34.0041 20.517 34.0041C24.266 34.0041 27.6741 32.4724 30.128 30.0217C32.5819 27.5709 34.1155 24.1671 34.1155 20.4229C34.1155 16.6787 32.5819 13.2749 30.128 10.8241C27.6741 8.37339 24.266 6.84167 20.517 6.84167C16.7681 6.84167 13.3599 8.37339 10.9061 10.8241C8.4522 13.2749 6.91854 16.6787 6.91854 20.4229H4.49875C4.49875 15.9979 6.30507 12.0155 9.20199 9.12223C12.0989 6.22898 16.0865 4.42496 20.517 4.42496C24.9476 4.42496 28.9352 6.22898 31.8321 9.12223C34.729 12.0155 36.5353 15.9979 36.5353 20.4229C36.5353 24.8479 34.729 28.8303 31.8321 31.7236C28.9352 34.6168 24.9476 36.4208 20.517 36.4208C17.995 36.4208 15.7456 37.442 14.1097 39.0758C12.4738 40.7096 11.4514 42.9902 11.4514 45.475V65.9319H9.03159V45.509H8.99751ZM13.4963 45.509V65.966H15.916H37.3874V63.5493H15.916V45.509H13.4963ZM15.916 50.1042V52.5209H37.3874V50.1042H15.916ZM37.4214 54.5972H15.9501V57.0139H37.4214V54.5972ZM37.4214 59.0903H15.9501V61.507H37.4214V59.0903Z"
        fill="#8DC44F"
      />
    </svg>
  </div>
  <span>
    <lfr-editable id="kdw-weddin-description-2" type="rich-text">
      Após fazer o download da imagem, vc pode compartilhar em suas redes
      sociais como um post.
    </lfr-editable>
  </span>
</div>

<div class="kdw__size">
  <div
    class="kdw__background_step d-flex justify-content-center align-items-center"
  >
    <svg
      width="41"
      height="66"
      viewBox="0 0 41 66"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        fill-rule="evenodd"
        clip-rule="evenodd"
        d="M7.6611 7.6611C10.9154 4.40682 15.4239 2.4068 20.407 2.4068C25.3562 2.4068 29.8647 4.40682 33.119 7.6611C36.3733 10.9154 38.3733 15.4239 38.3733 20.3731C38.3733 24.3392 37.0851 28.0003 34.9156 30.9834C34.8817 30.9495 34.8478 30.9156 34.8139 30.8817C34.3393 30.4071 33.8648 29.9664 33.3224 29.5257L33.3563 29.5596C35.2207 26.9494 36.3055 23.763 36.3055 20.3392C36.3055 15.9324 34.5088 11.9662 31.6274 9.08484C28.7461 6.20345 24.7799 4.40682 20.3731 4.40682C15.9663 4.40682 12.0001 6.20345 9.11874 9.08484C6.23735 11.9662 4.44072 15.9324 4.44072 20.3392H6.84753C6.84753 16.6103 8.37297 13.2205 10.8137 10.7798C13.2544 8.33907 16.6442 6.81363 20.3731 6.81363C24.1019 6.81363 27.4918 8.33907 29.9325 10.7798C32.3732 13.2205 33.8987 16.6103 33.8987 20.3392C33.8987 23.2545 32.9834 25.9325 31.4241 28.1359C30.8478 27.7969 30.2376 27.4579 29.5935 27.1528H29.6274C31.0173 25.2545 31.8308 22.9155 31.8308 20.407C31.8308 17.2544 30.5427 14.373 28.4749 12.3052C26.4071 10.2374 23.5596 8.94924 20.3731 8.94924C17.2205 8.94924 14.3391 10.2374 12.2713 12.3052C10.2035 14.373 8.91535 17.2205 8.91535 20.407H11.3222C11.3222 17.8985 12.3391 15.6612 13.9662 14.034C15.5934 12.4069 17.8646 11.3899 20.3392 11.3899C22.8477 11.3899 25.085 12.4069 26.7121 14.034C28.3393 15.6612 29.3562 17.9324 29.3562 20.407C29.3562 22.6104 28.5766 24.6104 27.2884 26.1698C27.9664 26.407 28.6105 26.6782 29.2206 26.9833C27.8986 26.3393 26.5087 25.8308 25.0511 25.4918H25.085C25.1528 25.424 25.2206 25.3562 25.2884 25.3223C26.5426 24.068 27.3223 22.3053 27.3223 20.407C27.3223 18.4748 26.5426 16.7459 25.2884 15.4917C24.0341 14.2374 22.2714 13.4578 20.3731 13.4578C18.4409 13.4578 16.712 14.2374 15.4578 15.4917C14.2035 16.7459 13.4239 18.5087 13.4239 20.407H15.8307C15.8307 19.1527 16.3392 18.0002 17.1527 17.1866C17.9663 16.373 19.1188 15.8646 20.3731 15.8646C21.6273 15.8646 22.7799 16.373 23.5935 17.1866C24.407 18.0002 24.9155 19.1527 24.9155 20.407C24.9155 21.6612 24.407 22.8138 23.5935 23.6274C22.7799 24.4409 21.6273 24.9494 20.3731 24.9494H6.54244V27.3562H20.3731C25.3223 27.3562 29.8308 29.3562 33.0851 32.6105C36.3394 35.8648 38.3394 40.3733 38.3394 45.3225C38.3394 50.2717 36.3394 54.7802 33.0851 58.0345C29.8308 61.2888 25.3223 63.2888 20.3731 63.2888C15.4239 63.2888 10.9154 61.2888 7.6611 58.0345C4.40683 54.7802 2.4068 50.2717 2.4068 45.3225H0C0 50.9497 2.27121 56.0345 5.96616 59.7294C9.66112 63.4244 14.7459 65.6956 20.3731 65.6956C26.0003 65.6956 31.0851 63.4244 34.78 59.7294C38.475 56.0345 40.7462 50.9497 40.7462 45.3225C40.7462 40.6106 39.1529 36.2716 36.475 32.8139L36.5089 32.8478C39.1868 29.3901 40.7801 25.085 40.7801 20.3731C40.7801 14.7459 38.5089 9.66112 34.8139 5.96616C31.119 2.27121 26.0342 0 20.407 0C14.7798 0 9.66112 2.27121 5.96616 5.96616C2.27121 9.66112 0 14.7459 0 20.3731H2.4068C2.4068 15.4239 4.40683 10.9154 7.6611 7.6611ZM20.407 24.9494C20.5087 24.9494 20.5765 24.9494 20.6782 24.9494C20.5765 24.9494 20.4748 24.9494 20.407 24.9494ZM20.407 29.424C24.8138 29.424 28.78 31.2207 31.6613 34.102C34.5427 36.9834 36.3394 40.9496 36.3394 45.3564C36.3394 49.7632 34.5427 53.7294 31.6613 56.6107C28.78 59.4921 24.8138 61.2888 20.407 61.2888C16.0002 61.2888 12.034 59.4921 9.15264 56.6107C6.27125 53.7294 4.47462 49.7632 4.47462 45.3564H6.88143C6.88143 49.0852 8.40687 52.4751 10.8476 54.9158C13.2883 57.3565 16.6781 58.882 20.407 58.882C24.1358 58.882 27.5257 57.3565 29.9664 54.9158C32.4071 52.4751 33.9326 49.0852 33.9326 45.3564C33.9326 41.6275 32.4071 38.2377 29.9664 35.797C27.5257 33.3563 24.1358 31.8308 20.407 31.8308H6.54244V29.424H20.407ZM20.407 33.8987C23.5596 33.8987 26.441 35.1868 28.5088 37.2546C30.5766 39.3224 31.8647 42.1699 31.8647 45.3564C31.8647 48.509 30.5766 51.3904 28.5088 53.4582C26.441 55.526 23.5935 56.8141 20.407 56.8141C17.2544 56.8141 14.373 55.526 12.3052 53.4582C10.2374 51.3904 8.94924 48.5429 8.94924 45.3564H11.356C11.356 47.8649 12.373 50.1022 14.0001 51.7293C15.6273 53.3565 17.8985 54.3734 20.3731 54.3734C22.8816 54.3734 25.1189 53.3565 26.746 51.7293C28.3732 50.1022 29.3901 47.831 29.3901 45.3564C29.3901 42.8479 28.3732 40.6106 26.746 38.9834C25.1189 37.3563 22.8477 36.3394 20.3731 36.3394H6.54244V33.8987H20.407ZM20.407 38.3733C22.3392 38.3733 24.068 39.1529 25.3223 40.4072C26.5765 41.6614 27.3562 43.4242 27.3562 45.3225C27.3562 47.2547 26.5765 48.9836 25.3223 50.2378C24.068 51.4921 22.3053 52.2717 20.407 52.2717C18.4748 52.2717 16.7459 51.4921 15.4917 50.2378C14.2374 48.9836 13.4578 47.2208 13.4578 45.3225H15.8646C15.8646 46.5767 16.3731 47.7293 17.1866 48.5429C18.0002 49.3564 19.1527 49.8649 20.407 49.8649C21.6612 49.8649 22.8138 49.3564 23.6274 48.5429C24.4409 47.7293 24.9494 46.5767 24.9494 45.3225C24.9494 44.0682 24.4409 42.9157 23.6274 42.1021C22.8138 41.2886 21.6612 40.7801 20.407 40.7801H6.54244V38.3733H20.407ZM29.2884 26.9833C29.3223 27.0172 29.3901 27.0172 29.424 27.0511L29.2884 26.9833ZM29.4579 27.0511C29.4918 27.085 29.5596 27.085 29.5935 27.1189C29.5257 27.1189 29.4918 27.085 29.4579 27.0511ZM20.6443 24.9494C20.746 24.9494 20.8138 24.9494 20.9155 24.9494C20.8138 24.9494 20.746 24.9494 20.6443 24.9494ZM20.9155 24.9494C20.9833 24.9494 21.085 24.9494 21.1528 24.9494C21.085 24.9494 21.0172 24.9494 20.9155 24.9494ZM21.1867 24.9494C21.2545 24.9494 21.3562 24.9494 21.424 24.9494C21.3562 24.9494 21.2545 24.9494 21.1867 24.9494ZM21.4578 24.9833C21.5256 24.9833 21.6273 24.9833 21.6951 24.9833C21.5934 24.9833 21.5256 24.9833 21.4578 24.9833ZM21.729 24.9833C21.7968 24.9833 21.8646 24.9833 21.9663 24.9833C21.8646 24.9833 21.7968 24.9833 21.729 24.9833ZM21.9663 25.0172C22.0341 25.0172 22.1019 25.0172 22.2036 25.0511C22.1358 25.0172 22.0341 25.0172 21.9663 25.0172ZM22.2375 25.0172C22.3053 25.0172 22.3731 25.0172 22.4409 25.0511C22.3731 25.0511 22.3053 25.0172 22.2375 25.0172ZM22.5087 25.0511C22.5765 25.0511 22.6443 25.0511 22.7121 25.085C22.6443 25.0511 22.5765 25.0511 22.5087 25.0511ZM22.7799 25.085C22.8477 25.085 22.9155 25.085 22.9833 25.1189C22.8816 25.085 22.8138 25.085 22.7799 25.085ZM23.0172 25.1189C23.085 25.1189 23.1189 25.1189 23.1867 25.1528C23.1528 25.1189 23.085 25.1189 23.0172 25.1189ZM23.2884 25.1528C23.3562 25.1528 23.3901 25.1528 23.4579 25.1867C23.3901 25.1528 23.3562 25.1528 23.2884 25.1528ZM23.5257 25.1867C23.5935 25.1867 23.6274 25.1867 23.6952 25.2206C23.6613 25.1867 23.5935 25.1867 23.5257 25.1867ZM23.7969 25.2206C23.8308 25.2206 23.8986 25.2206 23.9324 25.2545C23.9663 25.2545 24.0002 25.2545 24.068 25.2884L23.9324 25.2545C23.8986 25.2545 23.8647 25.2206 23.7969 25.2206ZM24.068 25.2884C24.1019 25.2884 24.1697 25.2884 24.2036 25.3223L24.3053 25.3562L24.407 25.3901L24.068 25.2884Z"
        fill="#8DC44F"
      />
    </svg>
  </div>
  <span>
    <lfr-editable id="kdw-weddin-description-3" type="rich-text">
      Não esqueça de usar a hashtag <strong>#orgulhoklabin</strong> para que
      todos possam acompanhar.
    </lfr-editable>
  </span>
</div>
</div>
<h2 class="kdw__image__title">OBTENHA A IMAGEM</h2>
<div
class="d-flex flex-wrap justify-content-center align-items-center kdw_cards_container"
>
<div class="kdw__weddin_cards kdw__weddin_download_card">
  <div class="d-flex justify-content-center align-items-center">
    <svg
      width="68"
      height="68"
      viewBox="0 0 68 68"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <circle cx="34" cy="34" r="34" fill="#EEEEEE" />
      <path
        d="M46.3529 37.8823V43.5294C46.3529 44.2782 46.0554 44.9964 45.5259 45.5259C44.9964 46.0554 44.2782 46.3529 43.5294 46.3529H23.7647C23.0158 46.3529 22.2977 46.0554 21.7682 45.5259C21.2386 44.9964 20.9412 44.2782 20.9412 43.5294V37.8823"
        stroke="#1C9344"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <path
        d="M26.5881 30.8235L33.647 37.8823L40.7058 30.8235"
        stroke="#1C9344"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <path
        d="M33.6471 37.8823V20.9412"
        stroke="#1C9344"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
  </div>
  <div class="d-flex justify-content-center align-items-center">
    <button type="button" id="downloadBodas">Download da imagem</button>
  </div>
</div>
<form id="kdw__email-form" class="kdw__weddin_cards kdw__weddin_email_card">
  <div class="d-flex justify-content-center align-items-center">
    <svg
      width="68"
      height="68"
      viewBox="0 0 68 68"
      fill="none"
      xmlns="http://www.w3.org/2000/svg"
    >
      <circle cx="34" cy="34" r="34" fill="#EEEEEE" />
      <path
        d="M22.0261 22H46.2348C47.8991 22 49.2609 23.35 49.2609 25V43C49.2609 44.65 47.8991 46 46.2348 46H22.0261C20.3617 46 19 44.65 19 43V25C19 23.35 20.3617 22 22.0261 22Z"
        stroke="#1C9344"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
      <path
        d="M49.2609 25.1306L34.1304 35.5654L19 25.1306"
        stroke="#1C9344"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      />
    </svg>
  </div>
  <div class="d-flex flex-column justify-content-center kdw__form-control">
    <label for="emailBodas">E-mail</label>
    <input
      class="kdw__weddin_email"
      type="email"
      placeholder="Digite o e-mail"
      id="emailBodas"
      required
    />
  </div>
  <div class="d-flex justify-content-center align-items-center">
    <button type="submit" id="sendEmailBodas">Enviar para o e-mail</button>
  </div>
</form>
</div>
    `

}

